
## 도메인 전용 언어(Domain Specific Languages, DSL)란?

DSL은 특정 비즈니스 도메인의 문제를 해결하려고 만든, 작은, 범용이 아닌 특정 도메인을 대상으로 만들어진 특수 프로그래밍 언어다.
예를 들어 쇼핑몰 플랫폼을 개발한다고 가정했을 때, 비지니스 도메인에는 상품을 결제하고 배송처리와 같은 개념이 포함된다.

- DSL은 특정 비즈니스 도메인의 문제를 해결하려고 만든 언어다.
    - 자바에서는 도메인을 표현할 수 있는 클래스와 메서드 집합이 필요하다. DSL이란 특정 비즈니스 도메인을 인터페이스로 만든 API라고 생각할 수 있다.
- DSL은 범용 프로그래밍 언어가 아니다.
    - DSL에서 동작과 용어는 특정 도메인에 국한되므로 다른 문제는 걱정할 필요가 없고 오직 자신의 앞에 놓인 문제를 어떻게 해결할지에만 집중할 수 있다
- DSL을 이용하면 사용자가 특정 도메인의 복잡성을 더 잘 다룰 수 있다
    - 저수준 구현 세부 사항 메서드는 클래스의 비공개로 만들어서 저수준 구현 세부 내용은 숨길 수 있다. 
    ( = 사용자 친화적인 DSL을 만들 수 있다.)

### DSL의 역할

다음의 두가지 필요성을 생각하면서 DSL을 개발해야 한다.

- 의사 소통의 왕
    - 코드의 의도가 명확히 전달되어야 하며 프로그래머가 아닌 사람도 이해할 수 있어야 한다.
    - 이런 방식으로 코드가 비즈니스 요구사항에 부합하는지 확인할 수 있다.
- 한 번 코드를 구현하지만 여러번 읽는다
    - 가독성은 유지보수의 핵심이다.
    - 즉, 항상 우리의 동료가 쉽게 이해할 수 있도록 코드를 구현해야한다.

## DSL의 장점과 단점

DSL은 코드의 비즈니스 의도를 명확하게 하고 가독성을 높인다는 점에서 약이 된다. 
반면, DSL구현은 코드이므로 올바로 검증하고 유지보수해야하는 책임이 따른다. 

따라서, DSL의 장점과 비용을 모두 확인해야만 프로젝트에 DSL을 추가하는 것이 투자대비 긍정적인 결과를 가져올 것인지 올바로 평가할 수 있다

### DSL의 장점

- 간결함
    - API는 비즈니스 로직을 간편하게 캡슐화하므로 반복을 피할 수 있고 코드를 간결하게 만들 수 있다
- 가독성
    - 도메인 영역의 용어를 사용하므로 비 도메인 전문가도 코드를 쉽게 이해할 수 있다.
    - 결과적으로 다양한 조직 구성원 간에 코드와 도메인 영역이 공유될 수 있다.
- 유지보수
    - 잘 설계된 DSL로 구현한 코드는 쉽게 유지보수하고 바꿀 수 있다.
    - 유지보수는 비즈니스 관련 코드 즉, 가장 빈번히 바뀌는 애플리케이션 부분에 특히 중요하다.
- 높은 수준의 추상화
    - DSL은 도메인과 같은 추상화 수준에서 동작하므로 도메인의 문제와 직접적으로 관련되지 않은 세부 사항을 숨긴다.
- 집중
    - 비즈니스 도메인의 규칙을 표현할 목적으로 설계된 언어이므로 프로그래머가 특정 코드에 집중할 수 있다. 결과적으로 생산성이 좋아진다.
- 관심사 분리
    - 지정된 언어로 비즈니스 로직을 표현함으로 애플리케이션의 인프라 구조와 관련된 문제와 독립적으로 비즈니스 관련된 코드에서 집중하기가 용이하다. 결과적으로 유지보수가 쉬운 코드를 구현한다.

### DSL의 단점

- DSL설계의 어려움
    - 간결하게 제한적인 언어에 도메인 지식을 담는 것이 쉬운 작업은 아니다.
- 개발 비용
    - 코드에 DSL을 추가하는 작업은 초기 프로젝트에 많은 비용과 시간이 소모되는 작업이다. 또한 DSL유지보수와 변경은 프로젝트에 부담을 주는 요소다.
- 추가 우회 계층
    - DSL은 추가적인 계층으로 도메인 모델을 감싸며 이 때 계층을 최대한 작게 만들어 성능 문제를 회피한다.
- 새로 배워야 하는 언어
    - 요즘에는 한 프로젝트에도 여러가지 언어를 사용하는 추세다. 하지만 DSL을 프로젝트에 추가하면서 팀이 배워야하는 언어가 한 개 더 늘어난다는 부담이 있다. 여러 비즈니스 도메인을 다루는 개별 DSL을 사용하는 상황이라면 이들을 유기적으로 동작하도록 합치는 일은 쉬운 일이 아니다. 개별 DSL이 독립적으로 진화할 수 있기 때문이다
- 호스팅 언어 한계
    - 장황한 프로그래밍 언어를 기반으로 만든 DSL은 성가신 문법의 제약을 받고 읽기가 어려워진다. 자바 8의 람다 표현식은 이 문제를 해결할 강력한 새 도구다.

## JVM에서 이용할 수 있는 DSL

### 내부 DSL

- (이 책은 자바 언어 책이므로)자바로 구현한 DSL을 의미
- 자바는 역사적으로 쉽고, 간단하고, 표현력있는 DSL을 만드는데 한계가 있었지만 람다 표현식이 등장하면서 이 문제를 어느정도 해결할 수 있었다.

### 순수 자바로 DSL을 구현함으로써 얻을 수 있는 장점

- 기존 자바 언어를 이용하면 외부 DSL에 비해 새로운 패턴과 기술을 배워 DSL 을 구현하는 노력이 현저하게 줄어든다.
- 순수 자바로 DSL을 구현하면 나머지 코드와 함께 DSL을 컴파일 할 수 있다.
    - 즉 추가로 비용이 들지 않는다 (다른 언어의 컴파일러를 이용하거나 외부 DSL을 만드는 도구를 사용할 필요가 없으므로)
- 팀원들이 새로운 언어를 배우거나 또는 익숙하지 않고 복잡한 외부 도구를 배울 필요가 없다
- DSL사용자는 기존의 자바 IDE를 이용해 자동 완성, 자동 리팩터링 같은 기능을 그대로 사용할 수 있다.
- 한개의 언어로 한개의 도메인 또는 여러 도메인을 대응하지 못해 추가로 DSL을 개발해야 하는 상황에서 자바를 이용한다면 추가 DSL을 쉽게 합칠 수 있다.

### 다중 DSL

- DSL은 기반 프로그래밍 언어의 영향을 받으므로 간결한 DSL을 만드는데 새로운 언어의 특성들이 아주 중요하다. (스칼라, 루비, 코틀린, 실론 등 )
- 특히 스칼라는 커링, 임의 변환 등 DSL개발에 필요한 여러 특성을 갖췄다 (DSL친화적이다)

### 다중 DSL 의 단점

- 새로운 프로그래밍 언어를 배우거나 또는 팀의 누군가가 이미 해당 기술을 가지고 있어야 한다. 
(기존언어의 고급기능을 사용할 수 있는 충분한 지식이 필요하기 때문)
- 두 개 이상의 언어가 혼재하므로 여러 컴파일러로 소스를 빌드하도록 빌드 과정을 개선해야 한다.
- JVM에서 실행되는 거의 모든 언어가 자바와 호환성이 완벽하지 않을 때가 많다. 이런 호환성 때문에 성능이 손실될 때도 있다. (예를 들어, 스칼라와 자바 컬렉션은 서로 호환되지 않으므로 상호 컬렉션을 전달하려면 기존 컬렉션을 대상 언어의 API에 맞게 변환해야한다. )

### 외부 DSL

- 자신만의 문법과 구문으로 새 언어를 설계해야한다. 
새 언어를 파싱하고, 파서의 결과를 분석하고, 외부 DSL을 실행할 코드를 만들어야한다.
- 이런 작업은 일반적인 작업도 아니며 쉽게 기술을 얻을 수도 없다.
- 쉽게 제어 범위를 벗어날 수 있으며 처음 설계한 목적을 벗어나는 경우가 많다

### 외부 DSL의 장점

- 외부 DSL이 제공하는 무한한 유연성
- 필요한 특성을 완벽하게 제공하는 언어를 설계할 수 있음
    - 제대로 언어를 설계하면 우리의 비즈니스 문제를 묘사하고 해결하는 가독성 좋은 언어를 얻을 수 있다.
- 자바로 개발된 인프라구조 코드와 외부 DSL로 구현한 비즈니스 코드를 명확하게 분리한다.
    - 하지만 이 분리로 인해 DSL과 호스트 언어 사이에 인공 계층이 생기므로 이는 양날의 검과 같다

### 정리

- DSL의 주요 기능은 개발자와 도메인 전문가 사이의 간격을 좁히는 것이다. 
애플리케이션의 비즈니스 로직을 구현하는 코드를 만든 사람이 프로그램이 사용될 비즈니스 필드의 전문지식을 갖추긴 어렵다. 개발자가 아닌 사람도 이해할 수 있는 언어로 이런 비즈니스 로직을 구현할 수 있다고 해서 도메인 전문가가 프로그래머가 될 수 있는 것은 아니지만 적어도 로직을 읽고 검증하는 역할은 할 수 있다.
- DSL은 크게 내부적DSL(DSL이 사용될 애플리케이션을 개발한 언어를 그대로 사용)과 외부적DSL(직접 언어를 설계해 사용함)로 분류할 수 있다. 내부적 DSL은 개발 노력이 적게 드는 반면 호스팅 언어의 문법 제약을 받는다. 외부적 DSL은 높은 유연성을 제공하지만 구현하기가 어렵다
- JVM에서 이용할 수 있는 스칼라, 그루비 등의 다른 언어로 다중 DSL을 개발할 수 있다. 이들 언어는 자바보다 유연하며 간결한 편이다. 하지만 이들을 자바와 통합하려면 빌드 과정이 복잡해지며 자바와의 상호호환성 문제도 생길 수 있다.
- 자바의 장황성과 문법적 엄격함 때문에 보통 자바는 내부적 DSL을 개발하는 언어로는 적합하지 않다. 하지만 자바 8의 람다 표현식과 메서드 참조 덕분에 상황이 많이 개선되었다.
